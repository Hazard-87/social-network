{"ast":null,"code":"import _regeneratorRuntime from\"/media/hazard/\\u041B\\u043E\\u043A\\u0430\\u043B\\u044C\\u043D\\u044B\\u0439 \\u0434\\u0438\\u0441\\u043A/react/project/react-deploy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/media/hazard/\\u041B\\u043E\\u043A\\u0430\\u043B\\u044C\\u043D\\u044B\\u0439 \\u0434\\u0438\\u0441\\u043A/react/project/react-deploy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/media/hazard/\\u041B\\u043E\\u043A\\u0430\\u043B\\u044C\\u043D\\u044B\\u0439 \\u0434\\u0438\\u0441\\u043A/react/project/react-deploy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{authAPI,securityAPI}from\"../api/api\";import{stopSubmit}from\"redux-form\";var SET_AUTH_USER='SET_AUTH_USER';var GET_CAPTCHA_URL_SUCCESS='GET_CAPTCHA_URL_SUCCESS';var initialState={userId:null,email:null,login:null,isAuth:false,captchaUrl:null};var authReducer=function authReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case SET_AUTH_USER:case GET_CAPTCHA_URL_SUCCESS:return _objectSpread(_objectSpread({},state),action.payload);default:return state;}};export var getAuthUserData=function getAuthUserData(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var response,_response$data$data,id,email,_login,isAuth;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return authAPI.me();case 2:response=_context.sent;if(response.data.resultCode===0){_response$data$data=response.data.data,id=_response$data$data.id,email=_response$data$data.email,_login=_response$data$data.login,isAuth=_response$data$data.isAuth;dispatch(setAuthUserData(id,email,_login,true));}case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};export var login=function login(email,password,rememberMe,captcha){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return authAPI.login(email,password,rememberMe,captcha);case 2:response=_context2.sent;if(response.data.resultCode===0){dispatch(getAuthUserData());}else{if(response.data.resultCode===10){dispatch(getCaptchaUrl());}dispatch(stopSubmit(\"login\",{_error:response.data.messages}));}case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var getCaptchaUrl=function getCaptchaUrl(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var response,captchaUrl;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return securityAPI.getCaptchaUrl();case 2:response=_context3.sent;captchaUrl=response.data.url;dispatch(getCaptchaUrlSuccess(captchaUrl));case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var logout=function logout(){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return authAPI.logout();case 2:response=_context4.sent;if(response.data.resultCode===0){dispatch(setAuthUserData(null,null,null,false));}case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}();};export var setAuthUserData=function setAuthUserData(userId,email,login,isAuth){return{type:'SET_AUTH_USER',payload:{userId:userId,email:email,login:login,isAuth:isAuth}};};export var getCaptchaUrlSuccess=function getCaptchaUrlSuccess(captchaUrl){return{type:'GET_CAPTCHA_URL_SUCCESS',payload:{captchaUrl:captchaUrl}};};export default authReducer;","map":{"version":3,"sources":["/media/hazard/Локальный диск/react/project/react-deploy/src/redux/auth-reducer.js"],"names":["authAPI","securityAPI","stopSubmit","SET_AUTH_USER","GET_CAPTCHA_URL_SUCCESS","initialState","userId","email","login","isAuth","captchaUrl","authReducer","state","action","type","payload","getAuthUserData","dispatch","me","response","data","resultCode","id","setAuthUserData","password","rememberMe","captcha","getCaptchaUrl","_error","messages","url","getCaptchaUrlSuccess","logout"],"mappings":"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","sourcesContent":["import {authAPI, securityAPI} from \"../api/api\";\nimport {stopSubmit} from \"redux-form\";\n\nconst SET_AUTH_USER = 'SET_AUTH_USER'\nconst GET_CAPTCHA_URL_SUCCESS = 'GET_CAPTCHA_URL_SUCCESS'\n\nlet initialState = {\n    userId: null,\n    email: null,\n    login: null,\n    isAuth: false,\n    captchaUrl: null\n}\n\nconst authReducer = (state = initialState, action) => {\n    switch (action.type) {\n        case SET_AUTH_USER:\n        case GET_CAPTCHA_URL_SUCCESS:\n            return {\n                ...state,\n                ...action.payload\n            }\n\n        default:\n            return state;\n    }\n}\n\nexport const getAuthUserData = () => {\n    return async (dispatch) => {\n        let response = await authAPI.me()\n        if (response.data.resultCode === 0) {\n            let {id, email, login, isAuth} = response.data.data\n            dispatch(setAuthUserData(id, email, login, true))\n        }\n    }\n}\n\nexport const login = (email, password, rememberMe, captcha) => async (dispatch) => {\n    let response = await authAPI.login(email, password, rememberMe, captcha)\n    if (response.data.resultCode === 0) {\n        dispatch(getAuthUserData())\n    } else { if (response.data.resultCode === 10) {\n        dispatch(getCaptchaUrl())\n    }\n        dispatch(stopSubmit(\"login\", {_error: response.data.messages}))\n    }\n}\n\nexport const getCaptchaUrl = () => async (dispatch) => {\n    const response = await securityAPI.getCaptchaUrl()\n    const captchaUrl = response.data.url\n    dispatch(getCaptchaUrlSuccess(captchaUrl))\n}\n\n\nexport const logout = () => {\n    return async (dispatch) => {\n        let response = await authAPI.logout()\n        if (response.data.resultCode === 0) {\n            dispatch(setAuthUserData(null, null, null, false))\n        }\n    }\n}\n\n\nexport const setAuthUserData = (userId, email, login, isAuth) => ({\n    type: 'SET_AUTH_USER',\n    payload: {userId, email, login, isAuth}\n})\nexport const getCaptchaUrlSuccess = (captchaUrl) => ({\n    type: 'GET_CAPTCHA_URL_SUCCESS', payload: {captchaUrl}\n})\n\nexport default authReducer;"]},"metadata":{},"sourceType":"module"}